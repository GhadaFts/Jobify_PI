<div class="max-w-4xl max-h-[85vh] overflow-y-auto" style="padding: 20px;">
  <h2 style="font-size: 24px; font-weight: 600; color: #111827;">
    Apply for {{ data.job.title }} at {{ data.job.company }}
  </h2>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
    {{ errorMessage }}
  </div>

  <div class="space-y-6 mt-4">
    
    <!-- AI-Powered ATS CV Generator -->
    <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg">
      <div class="flex items-start gap-3">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#1A73E8" stroke="none">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
        </svg>
        <div class="flex-1">
          <h4 style="font-size: 16px; color: #1A73E8; font-weight: 600;">AI-Powered ATS CV Generator</h4>
          <p style="font-size: 14px; color: #1A73E8;">
            Generate an ATS-optimized CV tailored specifically for <strong>{{ data.job.title }}</strong> at <strong>{{ data.job.company }}</strong>.
            Our AI will match your skills with job requirements and optimize for applicant tracking systems.
          </p>
          
          <div class="flex gap-2 mt-3">
            <button 
              (click)="generateTailoredCV()" 
              [disabled]="isGenerating" 
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" 
            >
              <span *ngIf="isGenerating" class="animate-spin">‚è≥</span>
              <span>{{ isGenerating ? 'Generating ATS CV...' : 'Generate ATS Optimized CV' }}</span>
            </button>
            
            <button 
              *ngIf="generatedCV"
              (click)="generatePDF()"
              class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Download PDF
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ATS Score Display -->
    <div *ngIf="generatedCV" class="p-4 bg-white border border-gray-200 rounded-lg">
      <div class="flex items-center justify-between">
        <div>
          <h4 style="font-size: 16px; font-weight: 600; color: #111827;">ATS Optimization Score</h4>
          <p style="font-size: 14px; color: #6B7280;">How well your CV matches the job requirements</p>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold" [style.color]="atsScoreColor">
            {{ generatedCV.atsScore }}/100
          </div>
          <div class="text-sm text-gray-500">ATS Score</div>
        </div>
      </div>
      
      <!-- Keywords Matched -->
      <div class="mt-3">
        <p class="text-sm font-medium text-gray-700">Keywords Matched:</p>
        <div class="flex flex-wrap gap-1 mt-1">
          <span *ngFor="let keyword of generatedCV.keywords.slice(0, 8)" 
                class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">
            {{ keyword }}
          </span>
        </div>
      </div>
    </div>

    <div style="text-align: center; color: #6B7280;">or</div>

    <!-- File Upload -->
    <div class="space-y-2">
      <label style="font-size: 14px; font-weight: 600; color: #111827;">Upload Your Existing CV</label>
      <input 
        type="file" 
        (change)="onFileSelected($event)" 
        accept=".pdf,.doc,.docx" 
        class="w-full p-2 border border-gray-300 rounded-lg" 
      />
      <p class="text-sm text-gray-500">Accepted formats: PDF, DOC, DOCX</p>
    </div>

    <!-- Generated CV Preview -->
    <div *ngIf="generatedCV" class="space-y-2">
      <div class="flex items-center gap-2">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="#6B7280" stroke="none">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <label style="font-size: 14px; font-weight: 600; color: #111827;">Generated CV Preview</label>
      </div>
      <div class="border border-gray-300 rounded-lg p-4 bg-gray-50 max-h-96 overflow-y-auto">
        <pre class="whitespace-pre-wrap font-mono text-sm">{{ formattedCV }}</pre>
      </div>
    </div>

    <!-- Cover Letter -->
    <div class="space-y-2">
      <label style="font-size: 14px; font-weight: 600; color: #111827;">Cover Letter (Optional)</label>
      <textarea 
        [(ngModel)]="coverLetter" 
        class="w-full min-h-[150px] p-2 border border-gray-300 rounded-lg" 
        placeholder="Write a personalized cover letter for this position..."
      ></textarea>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 pt-4 border-t" style="border-color: #E5E7EB;">
      <button 
        (click)="handleSubmit()" 
        [disabled]="!generatedCV && !uploadedFile" 
        class="px-4 py-2 rounded-full bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2" 
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Submit Application
      </button>
      <button 
        (click)="dialogRef.close()" 
        class="px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-100" 
      >
        Cancel
      </button>
    </div>
  </div>
</div>